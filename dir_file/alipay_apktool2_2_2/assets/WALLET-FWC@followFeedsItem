{"time":"0018","tplId":"WALLET-FWC@followFeedsItem","publishVersion":"150603","tag":"WALLET-FWC","name":"followFeedsItem","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"style","children":[{"text":"body {\n        -webkit-flex-direction: column;\n        flex-direction: column;\n        margin: 0px;\n        padding-bottom: 16px;\n    }\n\n    div {\n        display: -webkit-flex;\n        display: flex;\n        flex-direction: row;\n        position: relative;\n    }\n\n    .header {\n        margin-top: 16px;\n        margin-left: 12px;\n        margin-right: 12px;\n        display: flex;\n        align-items: center;\n    }\n\n    .header-img {\n        width: 32px;\n        height: 32px;\n        border-radius: 2.5px;\n    }\n\n    .header-badge-view {\n\t\tposition: absolute;\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\ttop: 1px;\n\t\tleft: 29px;\n    }\n\n    .header-public-name-div {\n        margin-left: 5px;\n        flex: 1;\n        flex-shrink: 1;\n        flex-direction: column;\n    }\n\n    .header-public-name-div-label {\n        font-size: 16px;\n        font-weight: bold;\n        color: #2a2a2a;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        overflow: hidden;\n    }\n\n    .header-time-div {\n        margin-left: 26px;\n        flex-shrink: 0;\n    }\n\n    .header-time-div-label {\n        font-size: 12px;\n        color: #b1b1b1;\n    }\n\n    .content {\n        display: flex;\n        margin-left: 12px;\n        margin-right: 12px;\n        margin-top: 16px;\n        flex-direction: column;\n    }\n\n    .content-label {\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        text-overflow: ellipsis;\n        overflow: hidden;\n    }\n\n    .service {\n        overflow: hidden;\n        height: 28px;\n        flex: 0;\n        flex-shrink: 0;\n        flex-wrap: wrap;\n        margin-left: 12px;\n        margin-right: 12px;\n        margin-top: 12px;\n    }\n\n    .service-tag-div {\n        border-radius: 14px;\n        border:1 #BCD1EE solid;\n        background-color: #F4FAFF;\n        margin-right: 9px;\n        align-items: center;\n    }\n\n    .service-tag-div-tag-img {\n        height: 15px;\n        width: 15px;\n        margin-left: 12px;\n    }\n\n    .service-tag-div-tag-label {\n        font-size: 12px;\n        color: #8EB7EE;\n        margin-left: 4px;\n        margin-right: 12px;\n    }","tag":"text"}],"type":"text/css"},{"tag":"script","children":[{"text":"function genServiceTag(data, index, title, iconUrl, url) {\n        var tagDiv = document.createElement('div');\n        var tagImg = document.createElement('img');\n        var tagLabel = document.createElement('label');\n        if (tagDiv && tagImg && tagLabel) {\n            tagDiv.className = 'service-tag-div';\n            tagDiv.addEventListener(\"click\", function(){\n    \t\t\tdocument.openURL(url);\n    \t\t\t// spm\n    \t\t\tvar extParams = {\"PublicId\" : data.followObjectId, \"ServiceName\" : title, \"DynamicTemplateId\" : data.templateId};\n    \t\t\tdocument.invoke(\"log\", {\"actionId\" : \"clicked\", \"extParams\" : extParams, \"seed\" : (\"a138.b1629.c2947_\" + (data.cellIndex + 1) + \".d11755_\" + (index + 1)), \"bizType\" : \"Channels\"});\n\t\t\t});\n\n            tagImg.className = 'service-tag-div-tag-img';\n            tagImg.src = iconUrl;\n            tagImg.defaultvalue = \"android-phone-wallet-ppchat/com.alipay.mobile.pubsvc/icon_service_default\";\n            tagImg.failurevalue = \"android-phone-wallet-ppchat/com.alipay.mobile.pubsvc/icon_service_default\";\n            tagImg.contentmode = 'ScaleAspectFit';\n            tagDiv.appendChild(tagImg);\n\n            tagLabel.className = 'service-tag-div-tag-label';\n            tagLabel.innerText = title;\n            tagDiv.appendChild(tagLabel);\n            // spm\n            var extParams = {\"PublicId\" : data.followObjectId, \"ServiceName\" : title, \"DynamicTemplateId\" : data.templateId};\n            document.invoke(\"log\", {\"actionId\" : \"exposure\", \"extParams\" : extParams, \"seed\" : (\"a138.b1629.c2947_\" + (data.cellIndex + 1) + \".d11755_\" + (index + 1)), \"bizType\" : \"Channels\"});\n        }\n        return tagDiv;\n    }\n\n    function updateBadgeSize(width, height) {\n    \tvar badgeView = document.querySelector('.header-badge-view');\n    \tvar header = document.querySelector('.header');\n    \tvar headerImage = document.querySelector('.header-img');\n    \tbadgeView.style.width = width;\n    \tbadgeView.style.height = height;\n    \tbadgeView.style.top = parseFloat(header.style.marginTop) - height / 2;\n    \tbadgeView.style.left = parseFloat(header.style.marginLeft) + parseFloat(headerImage.style.width) - width / 2;\n    }\n\n    function convertToNum(value) {\n    \treturn ((typeof(value) == 'string' || typeof(value) == 'number')) ?\n            parseInt(value + '') : 0;\n    }\n\n    function init() {\n        var node = {\n            headerImage: document.querySelector('.header-img'),\n            badgeView: document.querySelector('.header-badge-view'),\n            headerTitle: document.querySelector('.header-public-name-div-label'),\n            timeLabel: document.querySelector('.header-time-div-label'),\n            contentTitle: document.querySelector('.content-label'),\n            service: document.querySelector('.service'),\n        };\n\n        document.onreload = function(data) {\n            // avatar\n            node.headerImage.src = data.avatar;\n            // name\n            node.headerTitle.innerText = data.name;\n            // time\n            node.timeLabel.innerText = data.latestMsgTimeFormatted ? data.latestMsgTimeFormatted : \"\";\n            // badge\n            var unread = null;\n            var unreadMsgCount = convertToNum(data.unreadReplyCount);\n            var unreadFeedsCount = convertToNum(data.unreadFeedsCount);\n            var unreadTemplateCount = convertToNum(data.unreadTempleCount);\n    \t\t\n    \t\tif (unreadMsgCount + unreadTemplateCount > 0) {\n        \t\tunread = unreadMsgCount + unreadTemplateCount;\n        \t\tunread = unread + '';\n    \t\t} else if (unreadFeedsCount > 0) {\n       \t\t\tunread = \".\";\n    \t\t}\n            node.badgeView.value = unread;\n\n            // hint\n            var hintString = \"\";\n            if (unreadTemplateCount > 0) {\n                hintString = \"[有新通知]\";\n                hintString = '<font size=\"14\" color=\"#e33d3d\">' + hintString + '</font>';\n            } else if (unreadMsgCount > 0) {\n                hintString = \"[有新回复]\";\n                hintString = '<font size=\"14\" color=\"#e33d3d\">' + hintString + '</font>';\n            } else if (unreadFeedsCount > 0) {\n                hintString = \"[\" + unreadFeedsCount + \"条]\";\n                hintString = '<font size=\"14\" color=\"#818181\">' + hintString + '</font>';\n            }\n\n            // content sum\n            var newLatestMsg = data.msgSummary;\n            var newSum;\n            if (newLatestMsg) {\n                newSum = JSON.parse(newLatestMsg);\n            } else {\n                newSum = {};\n                var replaceMe = data.latestMsg;\n                replaceMe = replaceMe.replace(\"[我: ]\",\"我: \");\n                newSum.title = replaceMe;\n            }\n            var titleString = newSum.title;\n            if (newSum.desc) {\n            \ttitleString = titleString + '：' + newSum.desc;\n            }\n            if (!titleString) {\n            \ttitleString = '';\n            }\n            titleString = '<font size=\"14\" color=\"#818181\">' + titleString + '</font>';\n            node.contentTitle.innerText = hintString + titleString;\n\n            // service tag\n            node.service.innerHTML = '';\n            var linkTags = newSum.linkTags;\n            node.service.style.height = 0;\n            node.service.style.marginTop = 0;\n            if (typeof(linkTags) != undefined && linkTags != null && linkTags.length > 0) {\n                var linkTagsArray = JSON.parse(linkTags);\n                for (var i = 0; i < linkTagsArray.length; i++) {\n                    var serviceDict = linkTagsArray[i];\n                    var tagLabel = genServiceTag(data, i, serviceDict.serviceTitle, serviceDict.serviceIcon, serviceDict.serviceUrl);\n                    if (tagLabel) {\n                        node.service.appendChild(tagLabel);\n                    }\n                }\n                if (linkTagsArray.length > 0) {\n                    node.service.style.height = 30;\n                    node.service.style.marginTop = 12;\n                }\n            }\n        };\n    }","tag":"text"}],"type":"text/javascript"}]},{"style":"flex-direction: column;","onload":"init();","tag":"body","children":[{},{"tag":"div","children":[{"tag":"img","defaultvalue":"android-phone-wallet-ppchat/com.alipay.mobile.pubsvc/public_platform_default_icon","css":"header-img"},{"tag":"div","children":[{"tag":"label","css":"header-public-name-div-label"}],"css":"header-public-name-div"},{"tag":"div","children":[{"tag":"label","css":"header-time-div-label"}],"css":"header-time-div"}],"css":"header"},{"tag":"embed","type":"FBBadgeView","css":"header-badge-view"},{},{"tag":"div","children":[{"tag":"label","css":"content-label"}],"css":"content"},{},{"tag":"div","css":"service"}],"css":"body"}]},"format":"JSON","tplVersion":"5.2.3"}