{"time":"0017","tplId":"QUICKPAY@cashier-channel-logo-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-channel-logo-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var getTag=amc.fn.getById;var show=amc.fn.show;var hide=amc.fn.hide;var create=amc.fn.create;var rpc=amc.rpcData||{};var PATH=amc.path+\"alipay_msp_\";var HUI_PNG=PATH+\"hui\";var FAN_PNG=PATH+\"fan\";var BUSY_PNG=PATH+\"busy\";var RECOMMEND_PNG=PATH+\"recommend\";var CHARGE_FREE_PNG=PATH+\"free\";var GOU_PNG=PATH+\"gou\";var windowWidth=window.innerWidth||0;var APP_STATUS_OK=\"ok\";var APP_STATUS_NOT_INSTALL=\"notInstall\";var APP_STATUS_LOW_VERSION=\"lowVersion\";var bankAppPkgInfo={};var needRereshChannel=false;var bankAppStatusNotified=false;var calculatedChannelCreated=false;var TYPE_EBANK=\"cashierBankApp\";var TYPE_SHARE_PEER_PAY=\"sharePeerpay\";var TYPE_NEW_CARD=\"newCard\";var DEPOSIT_BIZ_TYPE=\"deposit\";var FRONT_DEFAULT_END_CODE=\"10000\";var loaded=false;var isReload=false;function onload(){if(isPrerender(flybird)){return}loadData(amc.rpcData)}function isPrerender(a){return a&&(a.local&&a.local.isPrerender||a.rpcData&&a.rpcData.isPrerender)}function loadData(a){if(loaded){return}amc.fn.spmPageCreate(\"a283.b4037\",{scene:rpc.scene});loaded=true;initGlobalVariable(a);init()}document.onreload=function(a){if(isPrerender(a)){return}isReload=true;if(a&&a.local){flybird.local=a.local}if(a&&a.rpcData){loadData(a.rpcData)}};function initGlobalVariable(a){rpc=a||{};scene=rpc.scene||\"cashier\";bizType=rpc.bizType;helpQuery=rpc.helpQuery||\"\";helpUrl=rpc.helpUrl||\"\"}function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var a;if(rpc.showLogo){a=amc.path+\"alipay_msp_i_logo\"}var b=rpc.exit?amc.res.close:amc.res.arrowLeft;var c=rpc.setting?\"{{setting}}\":null;var e=amc.fn.iNav(b,rpc.title||\"{{sel_pay_tool}}\",null,amc.res.help,onBack,onHelp,a,rpc.subtitle);getTag(\"body\").insertBefore(e,getTag(\"iLine\"));amc.fn.spmExposure(\"a283.b4037.c9697.d24460\");amc.fn.spmExposure(\"a283.b4037.c9697.d24459\");getTag(\"iNavImgR\")&&(getTag(\"iNavImgR\").alt=\"{{help}}\");if(getTag(\"iNavBoxR\")&&getTag(\"iNavBoxL\")&&c){getTag(\"iNavBoxR\").style.width=amc.isPlus?85:75;getTag(\"iNavBoxL\").style.width=amc.isPlus?85:75}getTag(\"iNavImgM\")&&(getTag(\"iNavImgM\").alt=\"{{alipay}}\");if(rpc.subScene===\"inside\"){getTag(\"body\").style.opacity=\"1\"}if(rpc.err){amc.fn.show(\"errMsgBox\");getTag(\"errMsg\").innerText=rpc.err;if(amc.fn.sdkGreaterThanOrEqual(\"10.8 .4\")){reportErrorCode(rpc.err)}}else{if(rpc.tips){amc.fn.show(\"tipsBox\");getTag(\"tips\").innerText=rpc.tips}}var d=gatherPkgInfo();if(d){registerNotification(\"channelLogoNotify\");setTimeout(function(){checkBankAppStatus()},10);setTimeout(function(){createOriginChannel()},60)}else{createOriginChannel()}}function reportErrorCode(b){var a={action:{name:\"loc:diagnose\",params:{biz:\"trade\",desc:b}}};document.submit(a)}function createOriginChannel(){if(calculatedChannelCreated){return}var a=getTag(\"channelBox\");createChannels(a);show(a);hide(\"refreshedChannelBox\")}function createChannels(a){if(!a){return}var d=(rpc.payments&&rpc.payments.length)||0;for(var c=0;c<d;c++){createPaymentItem(rpc.payments[c],a,false,c);createChildren(rpc.payments[c],a,c);var b=create(\"div\",\"amc-1px-line\"+(c<d-1?\" margin-l\":\"\"),a)}}function getLogoPath(b){b=b||{};var a=b.type;var c=b.logo||\"\";if(a==TYPE_NEW_CARD){c=PATH+\"add_card\"}else{if(a==TYPE_SHARE_PEER_PAY){c=PATH+\"peerpay_logo\"}else{if(a==TYPE_EBANK){c=PATH+\"ebank_logo\"}else{if(c.indexOf(\"local:\")===0){c=amc.path+c.substr(\"local:\".length)}}}}if(c!==b.logo){b.isLocalLogo=true}return c}function createPaymentItem(n,l,d,f){if(!l){return}if(!n.disable){n.detailAction=\"\"}if(n.add){n.type=TYPE_NEW_CARD}var j=windowWidth-30;var p=\" name-font-size\";var m=create(\"div\",\"cell-box amc-align-center\",l);n.logo=getLogoPath(n);var o=createLogo(m,n,d);j-=36;var i=create(\"div\",\"amc-v-box-center\",m);var a=create(\"div\",\"amc-align-center\",i);var c=create(\"label\",p+\" amc-ellipsis\",a);c.innerText=n.name||\"\";if(n.tail){var h=create(\"label\",p+\" amc-ellipsis\",a);h.innerText=n.tail;var e=max(calculateFontWidth(n.tail)*16,62);h.style.maxWidth=e;j-=e}if(n.rec){var k=create(\"img\",\"icon-wide\",a);k.src=RECOMMEND_PNG;j-=37.5}if(n.hui){var k=create(\"img\",\"icon\",a);k.src=HUI_PNG;j-=25}if(n.fan){var k=create(\"img\",\"icon\",a);k.src=FAN_PNG;j-=25}if(n.busy){var k=create(\"img\",\"icon\",a);k.src=BUSY_PNG;j-=25}var b=createDetails(i,n);var g=null;if(n.disable){disableItem(m,n,o,a)}else{if(!n.children||!n.children.length){g=bandOnclickEvent(m,n,d,f);j-=30}}j=max(j,104);c.style.maxWidth=j;return m}function calculateFontWidth(d){if(!d){return 0}var b=0;var c=/^[A-Za-z0-9\\.\\(\\)]*$/;for(var a=0;a<d.length;a++){if(c.test(d[a])){b+=0.5}else{b++}}return Math.round(b)}function max(d,c){return d>c?d:c}function disableItem(a,c,b,d){if(!a||!c){return}if(b){b.style.opacity=0.5}if(d){d.style.opacity=0.53}if(!c.detailAction){a.disabled=true}}function createDetails(e,h){if(!e||!h||!h.detail){return}var d=create(\"div\",\"amc-align-center detail-margin-t\",e);var g=\"detail-font-size\";var c=g+\" amc-flex-1 detail-font-color\"+(h.chargeFree?\" amc-line-through\":\"\");var a=create(\"label\",c+\" amc-ellipsis-3-line\",d);a.innerText=h.detail;if(h.detailAction){a.onclick=function(){var i={action:{name:h.detailAction,loadtxt:\"\"}};document.submit(i);if(h.dlg&&h.dlg[\"btnRightAction\"]){setTimeout(function(){showDlg(h.dlg)},1000)}}}if(h.chargeFree){a.className+=\" amc-ellipsis\";a.style.flex=0;var b=create(\"img\",\"icon\",d);b.src=CHARGE_FREE_PNG;var f=windowWidth-(30+36+30)-25;a.style.maxWidth=max(f,160)}}function createLogo(a,d,b){if(!d){return}var c=create(\"div\",\"channel-logo-size logo-margin-r amc-align-center amcjustify-center\",a);if(!b&&d.logo){var e=create(\"img\",\"channel-logo-size\",c);if(isReload&&amc.isAndroid){setTimeout(function(){e.src=d.logo},10)}else{e.src=d.logo}e.defaultvalue=PATH+\"bank_logo\";e.failurevalue=PATH+\"bank_logo\"}return c}function bandOnclickEvent(a,e,c,d){if(!a||!e){return}a.className+=\" amc-press-box\";var b=create(\"div\",\"amc-align-center right-img-box\",a);var f=create(\"img\",\"\",b);if(e.checked){f.src=GOU_PNG}else{if(!isConcreteChannel(e)){f.src=amc.res.arrowRight}}a.onclick=function(){amc.fn.spmClick(\"a283.b4037.c9697.d17387\");if(scene==\"cashier\"&&e.checked){amc.fn.back();return}var g=buildSubmitObj(e,c,d);f.src=amc.res.indicator;document.asyncSubmit(g,function(h){if(h.pageloading===\"1\"){f.src=amc.res.indicator}else{if(h.pageloading===\"0\"){f.src=isConcreteChannel(e)?\"\":amc.res.arrowRight}}})};return b}function getDefaultAction(c,d,b){var a=null;if(c==\"front\"){if(b==TYPE_NEW_CARD){a=(d==\"deposit\")?\"loc:back;/setting/addCard\":\"/frontpay/newCard\"}else{a=(d==\"deposit\")?\"loc:reload;loc:back\":\"loc:returnData\"}}else{a=\"/cashier/switchChannelSel\"}return a}function buildSubmitObj(f,a,c){f=f||{};var d={action:{name:f.action||getDefaultAction(scene,bizType,f.type)}};if(bizType!=\"deposit\"){d.action[\"loadtxt\"]=\"\"}if(scene==\"front\"){if(bizType==\"deposit\"){var i=f.value||{};if(amc.fn.isString(i)){try{i=JSON.parse(i)}catch(h){amc.fn.logError(\"channel\",\"渠道value错误\"+i.substr(0,30));i={cardInfo:{}}}}var b=i.cardInfo||{};d.param={index:c,logo:f.logo||\"\",limit:i.availableAmount||\"\",channel:i.assignedChannel||\"\",name:i.channelName||\"\",tail:b.cardNo||\"\"}}else{var g=insertExtParams(f.value,f);d.action[\"params\"]={resultStatus:f.endCode||\"10000\",result:toString(g),memo:\"\"}}}else{d.param={selected_channel:(a?f.parentValue:f.value),first_enter_cashier:false,child_channel:a?f.childValue:undefined};d.action[\"l2rmode\"]=isConcreteChannel(f)?\"1\":undefined;d.action[\"params\"]=amc.fn.isObject(f.params)?f.params:undefined}return d}function insertExtParams(b,a){if(!b||!isConcreteChannel(a)||!a.logo){return b}if(!amc.fn.isObject(b)){try{result=JSON.parse(b)}catch(c){amc.fn.logError(\"json\",\"渠道json解析错误\"+c);return b}}result=result||{};if(!a.isLocalLogo&&!result.bankLogoUrl){result.bankLogoUrl=a.logo}return result}function toString(a){if(a==undefined||a==null){return\"{}\"}if(typeof a==\"string\"){return a}else{if(typeof a==\"object\"){return JSON.stringify(a)}else{return a+\"\"}}}function createChildren(b,f,d){if(!f){return}var a=b&&b.children;if(!a||!a.length){return}for(var e=0;e<a.length;e++){var c=create(\"div\",\"amc-1px-line margin-l\",f);c.style.marginLeft=51;a[e][\"parentValue\"]=b.value;createPaymentItem(a[e],f,true,(d+\"-\"+e))}}function onHelp(){var a=\"https://csmobile.alipay.com/router.htm?scene=app_paymentlist\";if(helpUrl){a=helpUrl}else{if(helpQuery){a=(helpQuery.indexOf(\"&\")===0)?a+helpQuery:a+\"&\"+helpQuery}}amc.fn.logCount(\"help\",\"cashier-chnl\");document.submit({action:{name:\"loc:openweb('\"+a+\"', '{{help}}')\"}});amc.fn.spmClick(\"a283.b4037.c9697.d24460\")}function onBack(){amc.fn.spmClick(\"a283.b4037.c9697.d24459\");amc.fn.spmPageDestroy(\"a283.b4037\");if(rpc.exit){if(scene==\"front\"){amc.fn.exit()}else{amc.fn.exitConfirm()}}else{amc.fn.back()}}function onKeyDown(){if(event.which==4){onBack()}}function showDlg(a){if(!a||!a.btnRight||!a.dlgTxt||!a.btnLeft||!a.btnRight){return}getTag(\"dlgTxt\").innerText=a.dlgTxt;getTag(\"btnLeft\").innerText=a.btnLeft;getTag(\"btnRight\").innerText=a.btnRight;getTag(\"btnRight\").onclick=function(){var b={action:{name:a.btnRightAction}};document.submit(b);getTag(\"dlg\").close()};getTag(\"dlg\").showModal()}function gatherPkgInfo(){var a=false;if(amc.isAndroid){var g=rpc.payments.length||0;for(var d=0;d<g;d++){var f=rpc.payments[d];if(f.andPkgName&&!f.disable){var c=(f.andPkgName+\"\").trim();var e=f.andVersionCode||0;var b=c+\"-\"+e;bankAppPkgInfo[b]={pkgName:c,versionCode:e,status:APP_STATUS_OK};a=true}}}return a}function checkBankAppStatus(){var a=[];for(var b in bankAppPkgInfo){var c=bankAppPkgInfo[b];a.push({pkgName:c.pkgName,version:c.versionCode})}var d={action:{name:\"loc:checkEbank\",params:{notifyName:\"EBANK_STATUS\",ebanks:a}}};document.submit(d)}function registerNotification(b){var a={callbacks:{onNotify:b}};getTag(\"notification\").src=JSON.stringify(a)}function channelLogoNotify(a){if(!a){return}var c=null;var b={};try{b=JSON.parse(a)||{};c=b.notifyName}catch(d){amc.fn.logError(\"ebank\",\"解析安卓回调json错误\"+d)}if(c==\"EBANK_STATUS\"){handleBankStatus(b.ebanks)}}function handleBankStatus(b){if(!b){return}if(bankAppStatusNotified){return}bankAppStatusNotified=true;var f=[];try{f=JSON.parse(b)||{}}catch(j){amc.fn.logError(\"ebank\",\"解析安卓回调json错误\"+j)}if(!amc.fn.isArray(f)||f.length<=0){return}var h=f.length;for(var d=0;d<h;d++){var g=f[d];var a=g.status;if(a!=APP_STATUS_OK){var c=g.pkgName+\"-\"+g.version;if(bankAppPkgInfo[c]){bankAppPkgInfo[c][\"status\"]=a}needRereshChannel=true}}if(needRereshChannel){createCalculatedChannel()}}function isConcreteChannel(b){b=b||{};var a=b.type;return !(a==TYPE_NEW_CARD||a==TYPE_SHARE_PEER_PAY||a==TYPE_EBANK)}function createCalculatedChannel(){calculatedChannelCreated=true;var h=rpc.payments.length;for(var d=0;d<h;d++){var g=rpc.payments[d];if(g.disable){continue}var c=(g.andPkgName+\"\").trim();var f=g.andVersionCode||0;var b=c+\"-\"+f;var e=bankAppPkgInfo[b];if(e&&e.status!=APP_STATUS_OK){g.disable=true;if(e.status==APP_STATUS_NOT_INSTALL){g.detail=\"{{not_installed}}\"}else{if(e.status==APP_STATUS_LOW_VERSION){g.detail=\"{{low_version}}\"}}}}var a=getTag(\"refreshedChannelBox\");createChannels(a);hide(\"channelBox\");show(a)};","tag":"text"}]},{"tag":"style","children":[{"text":".channel-logo-size {\n        height: 24px;\n        width: 24px;\n    }\n\n    .logo-margin-r {\n        margin-right: 12px;\n    }\n\n    .icon {\n        margin-left: 9px;\n        height: 16px;\n        max-height: 16px;\n        min-height: 16px;\n        align-self: center;\n    }\n\n    .icon-wide {\n        margin-left: 9px;\n        height: 16px;\n        max-height: 16px;\n        min-height: 16px;\n        align-self: center;\n    }\n\n    .right-img-box {\n        width: 25px;\n        margin-left: 5px;\n        justify-content: flex-end;\n    }\n\n    .cell-pd-tb {\n        padding-top: 10px;\n        padding-bottom: 10px;\n    }\n\n    .btn-text {\n        font-weight: bold;\n        color: #108ee9;\n        margin: 15px 0;\n    }\n\n    .btn-vertical-line {\n        width: 1px;\n        align-self: stretch;\n        margin: 7px 0;\n        background-color: #e5e5e5;\n    }\n\n    .dlg-title {\n        -webkit-line-clamp: 4;\n        -webkit-box-orient: vertical;\n        display: -webkit-box;\n    }\n\n    .error-msg-box {\n        padding-top: 12px;\n        background-color: #ffeeee;\n    }\n\n    .error-msg {\n        margin: 0 15px;\n        font-size: 14px;\n        color: #f4333c;\n        text-align: left;\n        margin-bottom: 12px;\n    }\n\n    .pd-lr {\n        padding-left: 15px;\n        padding-right: 15px;\n    }\n\n    .pd {\n        padding: 15px;\n    }\n\n    .name-font-size {\n        font-size: 16px;\n    }\n\n    .detail-margin-t {\n        margin-top: 3px;\n    }\n\n    .detail-font-color {\n        color: #777;\n    }\n\n    .detail-font-size {\n        font-size: 14px;\n    }\n\n    .cell-box {\n        padding: 10px 15px;\n        min-height: 60px;\n    }\n\n    .margin-lr {\n        margin-left: 15px;\n        margin-right: 15px;\n    }\n\n    .margin-l {\n        margin-left: 15px;\n    }\n\n    .margin {\n        margin: 15px;\n    }\n\n    .amc-dlg-width {\n        width: 270px;\n        max-width: 270px;\n        min-width: 270px;\n    }\n\n    .amc-dlg-box {\n        border: 0;\n        background-color: #fff;\n        border-radius: 8px;\n        width: 270px;\n        align-items: center;\n    }\n\n    .amc-i-nav-l-box {\n        padding-left: 15px;\n        height: 46px;\n        justify-content: flex-start;\n        align-items: center;\n        width: 50px;\n    }\n\n    .amc-i-nav-r-box {\n        height: 46px;\n        justify-content: flex-end;\n        padding-right: 15px;\n        align-items: center;\n        width: 50px;\n    }\n\n    .channel-tips-box {\n        padding-top: 12px;\n        background-color: #f5f5f5;\n    }\n\n    .channel-tips {\n        font-size: 14px;\n        color: #666;\n        text-align: left;\n        margin-bottom: 12px;\n    }","tag":"text"}]}]},{"id":"body","onload":"onload();","tag":"body","children":[{"id":"iLine","tag":"div","css":"amc-1px-title-line"},{"tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"id":"errMsgBox","tag":"div","children":[{"id":"errMsg","tag":"label","css":"error-msg amc-flex-1 amc-ellipsis-2-line channel-logo-box"},{"tag":"div","css":"amc-adapt-line"}],"css":"error-msg-box amc-hidden amc-v-box"},{"id":"tipsBox","tag":"div","children":[{"id":"tips","tag":"label","css":"channel-tips amc-flex-1 amc-ellipsis-2-line margin-lr"},{"tag":"div","css":"amc-adapt-line"}],"css":"channel-tips-box amc-hidden amc-v-box"},{"id":"channelBox","tag":"div","css":"amc-v-box"},{"id":"refreshedChannelBox","tag":"div","css":"amc-v-box amc-hidden"},{"tag":"div","css":"amc-iphone-x-pd-b"}],"css":"amc-scroll-flex"}],"css":"amc-flex-1"}],"css":"amc-flex-1"},{"id":"dlg","tag":"dialog","children":[{"id":"dlgTxt","tag":"label","css":"amc-font-m amc-text-center margin dlg-title"},{"tag":"div","children":[{"tag":"div","css":"amc-adapt-line"},{"tag":"div","children":[{"id":"btnLeft","tag":"label","onclick":"getTag('dlg').close();","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center amc-ellipsis-2-line"},{"tag":"div","css":"btn-vertical-line"},{"id":"btnRight","tag":"label","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center amc-ellipsis-2-line"}],"css":"amc-align-center amc-justify-center"}],"css":"amc-v-box amc-justify-center amc-dlg-width"}],"css":"amc-dlg-box amc-v-box"},{"id":"notification","tag":"embed","type":"MQPBNNotification","css":"amc-hidden"}],"onkeydown":"onKeyDown();","css":"amc-i-body"}]},"format":"JSON","tplVersion":"5.2.9"}