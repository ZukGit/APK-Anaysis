{"time":"0016","tplId":"QUICKPAY@waika-validate-flex","publishVersion":"150924","tag":"QUICKPAY","name":"waika-validate-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var rpc=flybird.rpcData;var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var path=amc.path+\"alipay_msp_\";var loadImg=path+\"loading_blue.gif\";var successImg=path+\"success_blue.gif\";var validateLabels=new Array();var cvv2Circles=new Array();var validate=\"\";var cvv2=\"\";var maxLength=7;rpc.cvv2=rpc.cvv2||{display:true};rpc.validate=rpc.validate||{display:true};var showCvv2=rpc.cvv2&&rpc.cvv2.display;var showValidate=rpc.validate&&rpc.validate.display;function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var a=amc.fn.iNav(amc.res.close,\"{{confirm_pay}}\",null,null,onBack,null);getTag(\"body\").insertBefore(a,getTag(\"iLine\"));if(!showValidate){hide(\"validateInfoArea\");hide(\"validateArea\");hide(\"infoMargin\");hide(\"inputMargin\");maxLength-=4;getTag(\"cvvInfo\").className+=\" amc-text-center\"}if(!showCvv2){maxLength-=3;hide(\"cvvArea\");hide(\"cvvInfoArea\");hide(\"infoMargin\");hide(\"inputMargin\");getTag(\"validateInfo\").className+=\" amc-text-center\"}setTimeout(function(){getTag(\"hiddenInput\").focus()},80);validateLabels=document.querySelectorAll(\".amc-num-item\");cvv2Circles=document.querySelectorAll(\".amc-black-point\")}function onPaySuccess(){getTag(\"loadGif\").src=successImg;getTag(\"pwd_load_text\").innerText=\"{{pay_ok}}\"}function submit(){var b={action:{name:\"/cashier/cardValidate\",host:flybird.rpcData.pci_url,https:true,neec:\"6004\",loadtxt:\"\",enctype:\"application/x-www-form-urlencoded\",request_param:\"requestData\"}};var a={};if(showValidate){a.validate=validate}if(showCvv2){a.cvv2=cvv2}b.param=a;getTag(\"hiddenInput\").blur();getTag(\"loadGif\").src=loadImg;show(\"pwd_load\");document.asyncSubmit(b,function(c){if(c.status==\"0001\"){onPaySuccess()}else{if(c.status==\"0000\"){getTag(\"hiddenInput\").value=\"\";getTag(\"hiddenInput\").focus();getTag(\"loadGif\").src=\"\";hide(\"pwd_load\");onUserInput()}}})}function onBack(){document.confirm({title:\"\",message:\"{{confirm_cancel_pay}}\",okButton:\"{{confirm_btn}}\",cancelButton:\"{{cancel}}\"},function(a){if(a.ok){document.submit({action:{name:\"loc:exit\"}})}})}function requestFocus(){getTag(\"hiddenInput\").focus()}function resetVlidateAndCVV2(){for(var a=0;a<4;a++){validateLabels[a].innerText=\"\"}for(var a=0;a<3;a++){hide(cvv2Circles[a])}}function onUserInput(){resetVlidateAndCVV2();var a=getTag(\"hiddenInput\");var d=a.value||\"\";if(showValidate){validate=\"\";for(var b=0;b<d.length&&b<4;b++){validateLabels[b].innerText=d.substr(b,1);validate=validate+d.substr(b,1)}}if(showCvv2){var c=showValidate?4:0;cvv2=\"\";for(var b=c;b<d.length&&b<maxLength;b++){show(cvv2Circles[b-c]);cvv2=cvv2+d.substr(b,1)}}if(d.length>=maxLength){a.value=d.substr(0,maxLength)||\"\";submit()}}function onKeyDown(){if(event.which==4){onBack()}};","tag":"text"}]},{"tag":"style","children":[{"text":".input-title-box {\n    display:flex;\n}\n.input-title-ellipsis {\n    -webkit-line-clamp:3;\n    -webkit-box-orient:vertical;\n    display:-webkit-box;\n}\n.paying-box {\n    flex-direction: column;\n    padding-left: 15px;\n    padding-right: 15px;\n}\n.hidden-input {\n    height: 1px;\n    max-height: 1px;\n    max-width: 1px;\n    width: 1px;\n}\n.marin-l-l {\n    margin-left: 20px;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"iLine","tag":"div","css":"amc-1px-title-line"},{"tag":"div","children":[{},{"tag":"div","children":[{"tag":"div","css":"amc-flex-space-1"},{"id":"validateInfoArea","tag":"div","children":[{"id":"validateInfo","tag":"label","children":[{"text":"{{waika_validity}}","tag":"text"}],"css":"amc-font-m amc-flex-1 input-title-ellipsis"}],"css":"amc-pd-tb input-title-box amc-num-box-width"},{"id":"infoMargin","tag":"div","css":"amc-abs-space-h-l"},{"id":"cvvInfoArea","tag":"div","children":[{"id":"cvvInfo","tag":"label","children":[{"text":"{{waika_cvv}}","tag":"text"}],"css":"amc-font-m amc-flex-1 input-title-ellipsis"}],"css":"amc-pd-tb input-title-box amc-num-box-4-3-width"},{"tag":"div","css":"amc-flex-space-1"}]},{},{"tag":"div","children":[{"tag":"div","css":"amc-flex-space-1"},{},{"id":"validateArea","tag":"div","children":[{"tag":"div","children":[{"id":"p0","tag":"label","css":"amc-num-item"},{"tag":"div","css":"amc-adapt-num-line"},{"id":"p1","tag":"label","css":"amc-num-item"},{"tag":"div","css":"amc-adapt-num-line"},{"id":"p2","tag":"label","css":"amc-num-item"},{"tag":"div","css":"amc-adapt-num-line"},{"id":"p3","tag":"label","css":"amc-num-item"}],"css":"amc-num-box"}],"onclick":"requestFocus();","css":"amc-flex-center"},{"id":"inputMargin","tag":"div","css":"amc-abs-space-h-l"},{},{"id":"cvvArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"div","css":"amc-black-point"}],"css":"amc-flex-1 amc-flex-center"},{"tag":"div","css":"amc-adapt-num-line"},{"tag":"div","children":[{"tag":"div","css":"amc-black-point"}],"css":"amc-flex-1 amc-flex-center"},{"tag":"div","css":"amc-adapt-num-line"},{"tag":"div","children":[{"tag":"div","css":"amc-black-point"}],"css":"amc-flex-1 amc-flex-center"}],"css":"amc-num-box amc-num-box-4-3"}],"onclick":"requestFocus();","css":"amc-flex-center"},{"tag":"div","css":"amc-flex-space-1"}]}],"css":"amc-pd-tb amc-v-box"},{},{"id":"hiddenInput","keyboard":"safe","tag":"input","value":"","type":"number","css":"hidden-input","oninput":"onUserInput()"},{},{"id":"pwd_load","tag":"div","children":[{"tag":"div","css":"amc-flex-space-1"},{"id":"loadGif","tag":"embed","type":"MQPPayGifView","css":"amc-load-img"},{"tag":"div","css":"amc-abs-space-v-l"},{"tag":"div","children":[{"id":"pwd_load_text","tag":"label","children":[{"text":"{{paying}}","tag":"text"}],"css":"amc-font-l-white amc-text-center amc-flex-1 amc-ellipsis"}],"css":"paying-box"},{"tag":"div","css":"amc-flex-space-2"}],"css":"amc-loading-box"}],"onkeydown":"onKeyDown();","css":"amc-i-body"}]},"format":"JSON","tplVersion":"5.0.8"}