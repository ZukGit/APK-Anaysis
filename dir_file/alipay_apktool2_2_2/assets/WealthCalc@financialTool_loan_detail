{"time":"0039","tplId":"WealthCalc@financialTool_loan_detail","publishVersion":"151217","tag":"WealthCalc","name":"financialTool_loan_detail","data":{"tag":"html","children":[{"tag":"head","children":[{"content":"text/html; charset=UTF-8","tag":"meta","http-equiv":"Content-Type"},{"tag":"meta","src":"WealthCalc.bundle/financial.i18n","type":"i18n"},{"tag":"meta","src":"android-phone-wallet-wealthcalc/financial.i18n","type":"i18n"},{"content":"spmId:a213.b2240;bizType:fmtool;","tag":"meta","type":"bizData"},{"tag":"style","children":[{"text":"div {\n            display: flex;\n        }\n        \n        .cell_left_label {\n            font-size: 14px;\n            color: #000000;\n        }\n        \n        .cell_right_label {\n            font-size: 14px;\n            color: #666666;\n        }\n        \n        .vert_line {\n            width: 1px;\n            background-color: #26b6f0;\n            height: 54px;\n        }\n        \n        .box_div {\n            flex: 1;\n            flex-direction: column;\n            height: 54px;\n        }\n        \n        .top_label {\n            font-size: 10px;\n            color: #ffffff;\n            flex: 1;\n            text-align: center;\n        }\n        \n        .bottom_label {\n            font-size: 15px;\n            margin-top: 7px;\n            color: #ffffff;\n            font-auto-adjust: true;\n            white-space: nowrap;\n            text-align: center;\n        }\n        \n        .title_label {\n            font-size: 12px;\n            color: #1274d5;\n            flex: 1;\n            margin-top: 4px;\n            margin-bottom: 4px;\n        }","tag":"text"}]},{"tag":"script","children":[{"text":"var itemIndex = 0;\n        var arrItem = new Array();\n        var arrLabelItem = new Array();\n        var rpcData;\n\n        var arrType_a = new Array();\n        var arrType_b = new Array();\n\n        var WealthCalc_bundle = \"WealthCalc.bundle/\";\n        if (document.platform == \"android\") {\n            WealthCalc_bundle = \"android-phone-wallet-wealthcalc/\"\n            UICommon_bundle = \"com.alipay.mobile.wealthtools/\";\n        }\n\n        function changeItem(index) {\n\n            arrItem[index].style.backgroundColor = \"#ffffff\";\n            arrItem[1 - index].style.backgroundColor = \"#108ee9\";\n\n            arrLabelItem[index].style.color = \"#1274d5\";\n            arrLabelItem[1 - index].style.color = \"#ffffff\";\n        }\n\n        function item_click() {\n\n            itemIndex = 1 - itemIndex;\n            \n            // 等额本息埋点\n            if (itemIndex == 0) {\n                document.invoke(\"log\", {\n                        \"actionId\": \"clicked\",\n                        \"extParams\": {},\n                        \"appId\": \"20000161\",\n                        \"seed\": \"a213.b2240.c4970.d7809\",\n                        \"bizType\": \"fmtool\",\n                    }, function(rsp) {\n                    });\n            }\n            // 等额本金埋点\n            else if (itemIndex == 1) {\n                document.invoke(\"log\", {\n                        \"actionId\": \"clicked\",\n                        \"extParams\": {},\n                        \"appId\": \"20000161\",\n                        \"seed\": \"a213.b2240.c4970.d7810\",\n                        \"bizType\": \"fmtool\",\n                    }, function(rsp) {\n                    });\n            }\n            \n            changeItem(itemIndex);\n\n            total_calc();\n        }\n\n        function calc_total(month, rate, money) {\n\n            rate = rate / 100 / 12;\n            var temp = Math.pow(1 + rate, month);\n            return (money * 10000 * rate * temp) / (temp - 1);\n        }\n\n        function fmoney(s) {\n            var l = s.split(\".\")[0].split(\"\").reverse();\n\n            r = s.split(\".\")[1];\n            t = \"\";\n\n            for (i = 0; i < l.length; i++) {\n                t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? \",\" : \"\");\n            }\n\n            var ret = t.split(\"\").reverse().join(\"\");\n            if (r != undefined) {\n                ret = ret + \".\" + r;\n            }\n\n            return ret;\n        }\n\n        function calc_benjin(month, rate, money, curmonth) {\n            var pow = Math.pow(1 + rate, curmonth - 1);\n            var pow2 = Math.pow(1 + rate, month);\n            var fm = pow2 - 1;\n            return money * rate * pow / fm;\n        }\n\n        function total_calc() {\n            //### 等额本息\n            if (itemIndex == 0) {\n                var rate_a = rpcData.businessLoanRate / 100 / 12;\n                var result = calc_total(rpcData.month, rpcData.businessLoanRate, rpcData.businessLoan);\n                var result_a = result;\n                var lixi_a = result * rpcData.month - rpcData.businessLoan * 10000;\n                var zonge_a = result * rpcData.month;\n\n                var rate_b = rpcData.providentFundLoanRate / 100 / 12;\n                result = calc_total(rpcData.month, rpcData.providentFundLoanRate, rpcData.providentFundLoan);\n                var lixi_b = result * rpcData.month - rpcData.providentFundLoan * 10000;\n                var zonge_b = result * rpcData.month;\n                var result_b = result;\n\n                document.getElementById(\"total_lixi\").innerText = fmoney(((lixi_a + lixi_b) / 10000).toFixed(2));\n                document.getElementById(\"total_all\").innerText = fmoney(((zonge_a + zonge_b) / 10000).toFixed(2));\n\n                if (arrType_a.length == 0) {\n\n                    var total_pay = zonge_a + zonge_b;\n\n                    for (var i = 0; i < rpcData.month; i++) {\n\n                        total_pay = Math.abs(total_pay - result_a - result_b);\n                        var obj = {};\n                        obj.month = ((i % 12) + 1).toString() + \"{{月}}\";\n                        var benjinpermonth_a = calc_benjin(rpcData.month, rate_a, rpcData.businessLoan * 10000, i + 1);\n                        var benjinpermonth_b = calc_benjin(rpcData.month, rate_b, rpcData.providentFundLoan * 10000, i + 1);\n                        obj.benjin = fmoney((benjinpermonth_a + benjinpermonth_b).toFixed(2));\n                        var lixipermonth_a = result_a - benjinpermonth_a;\n                        var lixipermonth_b = result_b - benjinpermonth_b;\n                        obj.lixi = fmoney((lixipermonth_a + lixipermonth_b).toFixed(2));\n\n                        obj.remain = fmoney((total_pay).toFixed(2));\n                        arrType_a.push(obj);\n                    }\n                }\n\n                document.getElementById(\"table\").dataSource = arrType_a;\n            }\n            //### 等额本金\n            else {\n\n                var rate_a = rpcData.businessLoanRate / 100 / 12;\n                var benjin_a = rpcData.businessLoan * 10000 / rpcData.month;\n                var dijian_a = benjin_a * rate_a;\n                var lixi_a = rpcData.businessLoan * 10000 * rate_a;\n\n                var totol_lixi_a = 0;\n                var totol_benjin_a = rpcData.businessLoan * 10000;\n                for (var i = 0; i < rpcData.month; i++) {\n                    totol_lixi_a = totol_lixi_a + totol_benjin_a * rate_a;\n                    totol_benjin_a = totol_benjin_a - benjin_a;\n                }\n\n                var rate_b = rpcData.providentFundLoanRate / 100 / 12;\n                var benjin_b = rpcData.providentFundLoan * 10000 / rpcData.month;\n                var dijian_b = benjin_b * rate_b;\n                var lixi_b = rpcData.providentFundLoan * 10000 * rate_b;\n\n                var totol_lixi_b = 0;\n                var totol_benjin_b = rpcData.providentFundLoan * 10000;\n                for (var i = 0; i < rpcData.month; i++) {\n                    totol_lixi_b = totol_lixi_b + totol_benjin_b * rate_b;\n                    totol_benjin_b = totol_benjin_b - benjin_b;\n                }\n\n                document.getElementById(\"total_lixi\").innerText = fmoney(((totol_lixi_a + totol_lixi_b) / 10000).toFixed(2));\n                document.getElementById(\"total_all\").innerText = fmoney(((totol_lixi_a + totol_lixi_b) / 10000 + rpcData.businessLoan + rpcData.providentFundLoan).toFixed(2));\n\n                if (arrType_b.length == 0) {\n                    var total_pay = (totol_lixi_a + rpcData.businessLoan * 10000) + (totol_lixi_b + rpcData.providentFundLoan * 10000);\n\n                    for (var i = 0; i < rpcData.month; i++) {\n\n                        print(lixi_a + lixi_b);\n\n                        total_pay = Math.abs(total_pay - benjin_a - lixi_a - benjin_b - lixi_b);\n\n                        var obj = {};\n                        obj.month = ((i % 12) + 1).toString() + \"{{月}}\";\n                        obj.benjin = fmoney((benjin_a + benjin_b).toFixed(2)); //benjin_a + benjin_b;\n                        obj.lixi = fmoney((lixi_a + lixi_b).toFixed(2)); //lixi_a + lixi_b;\n                        obj.remain = fmoney((total_pay).toFixed(2));\n\n                        lixi_a = lixi_a - dijian_a;\n                        lixi_b = lixi_b - dijian_b;\n\n                        arrType_b.push(obj);\n                    }\n                }\n\n                document.getElementById(\"table\").dataSource = arrType_b;\n            }\n        }\n\n        function init() {\n\n            arrItem.push(document.getElementById(\"item_a\"));\n            arrItem.push(document.getElementById(\"item_b\"));\n\n            arrLabelItem.push(document.getElementById(\"label_a\"));\n            arrLabelItem.push(document.getElementById(\"label_b\"));\n            document.onreload = function (data) {\n\n                document.getElementById(\"month\").innerText = data.month;\n                document.getElementById(\"total_benjin\").innerText = parseFloat(data.businessLoan + data.providentFundLoan).toFixed(2);\n\n                if (data.type == 1) {\n                    itemIndex = 1;\n                    changeItem(itemIndex);\n                }\n\n                rpcData = data;\n                total_calc();\n\n                var table = document.getElementById(\"table\");\n\n                table.listModel = {\n                    \"cell\": function (data, row, section) {\n                        return {\n                            \"tpl\": WealthCalc_bundle + \"WealthCalc@financialTool_loan_detail_cell\",\n                            \"height\": 30,\n                            \"data\": JSON.stringify(data[section * 12 + row])\n                        }\n                    },\n                    \"section\": function (data, section) {\n                        return {\n                            \"tpl\": WealthCalc_bundle + \"WealthCalc@financialTool_loan_detail_header\",\n                            \"data\": JSON.stringify({\n                                \"year\": \"{{第}} \" + (section + 1) + \" {{年}}\"\n                            })\n                        }\n                    },\n                    \"sectionCount\": function (data) {\n                        return rpcData.month / 12;\n                    },\n                    \"rowCount\": function (data, section) {\n                        return 12;\n                    }\n                };\n            }\n        }","tag":"text"}]}]},{"id":"bodyid","style":"flex-direction:column; height:100%; background-color:#f5f5f9;","onload":"init();","tag":"body","children":[{"style":"background-color:#108ee9; width:100%; flex-direction:column; align-items:center;","tag":"div","children":[{"style":"width:221px; height:23px; border-radius:4px; border:1px #ffffff solid; margin-top:12px;","tag":"div","children":[{"id":"item_a","style":"border-radius:4px 4px 0px 0px 0px 0px 4px 4px;flex:1;align-items:center;justify-content:center; background-color:#ffffff;","tag":"div","children":[{"id":"label_a","style":"font-size:12px; color:#1274d5;","tag":"label","children":[{"text":"{{等额本息}}","tag":"text"}]}],"onclick":"item_click()"},{"id":"item_b","style":"border-radius:0px 0px 4px 4px 4px 4px 0px 0px;flex:1;align-items:center;justify-content:center; background-color:#108ee9;","tag":"div","children":[{"id":"label_b","style":"font-size:12px; color:#ffffff;","tag":"label","children":[{"text":"{{等额本金}}","tag":"text"}]}],"onclick":"item_click()"}]},{"style":"width:100%; padding:10px 0px 0px 0px;","tag":"div","children":[{"style":"flex:1.001;","tag":"div","children":[{"tag":"label","children":[{"text":"{{总还款(万)}}","tag":"text"}],"css":"top_label"},{"id":"total_all","tag":"label","css":"bottom_label"}],"css":"box_div"},{"tag":"div","css":"vert_line"},{"tag":"div","children":[{"tag":"label","children":[{"text":"{{总利息(万)}}","tag":"text"}],"css":"top_label"},{"id":"total_lixi","tag":"label","css":"bottom_label"}],"css":"box_div"},{"tag":"div","css":"vert_line"},{"tag":"div","children":[{"tag":"label","children":[{"text":"{{总贷款(万)}}","tag":"text"}],"css":"top_label"},{"id":"total_benjin","tag":"label","css":"bottom_label"}],"css":"box_div"},{"tag":"div","css":"vert_line"},{"tag":"div","children":[{"tag":"label","children":[{"text":"{{贷款月数}}","tag":"text"}],"css":"top_label"},{"id":"month","tag":"label","css":"bottom_label"}],"css":"box_div"}]}]},{"style":"background-color:#ffffff; align-items: center;","tag":"div","children":[{"style":"flex:1;","tag":"div","children":[{"style":"margin-left:15px;","tag":"label","children":[{"text":"{{月份}}","tag":"text"}],"css":"title_label"}]},{"tag":"label","children":[{"text":"{{月供本金}}","tag":"text"}],"css":"title_label"},{"tag":"label","children":[{"text":"{{月供利息}}","tag":"text"}],"css":"title_label"},{"tag":"label","children":[{"text":"{{剩余}}","tag":"text"}],"css":"title_label"}]},{"id":"table","style":"width:100%; flex:1;","tag":"table"}]}]},"format":"JSON","tplVersion":"5.0.4"}