{"time":"0006","tplId":"QUICKPAY@bizapp-collect-money","publishVersion":"150924","tag":"QUICKPAY","name":"bizapp-collect-money","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var getTag=amc.fn.getById;var create=amc.fn.create;var hide=amc.fn.hide;var show=amc.fn.show;var rpc=amc.rpcData||{};var validInputReg=\"^(([1-9]{1}\\\\d{0,7})|([0]{1}))(\\\\.(\\\\d){0,2})?$\";var defaultAvatar=amc.path+\"alipay_msp_user\";var inputWidth=window.innerWidth-60;var TEXT_SIZE_THRESHOLD=Math.floor(inputWidth/32);var MAX_COMMENT_SIZE=20;var LOG_CODE=\"QR\";var gAmountTag=null;var gCommentTag=null;var nickName=rpc.mNick||\"\";var realNameInfo=rpc.mName?\"(\"+rpc.mName+\")\":\"\";var paymentType=\"付款\";var isDefaultAmountPay=isDefaultAmountPay();var limitAmount=rpc.limitAmount?parseFloat(rpc.limitAmount):(isC2C()?50000:99999999.99);var gComment=\"\";var gAmount=\"\";var gMemoName=\"\";var gToastDisabled=false;var TRADE_NO_PREFIX=isC2C()?\"TQP005\":\"TQP003\";var gTradeNo=gTradeNo;var gIsEnterprise=isEnterprise();var showC2CLabel=isC2C()&&!gIsEnterprise;function init(){try{initUI();setTimeout(function(){document.invoke(\"preload\",{page:\"bizapp-collect-money\",action:\"/cashier/main\"})},0);amc.fn.logCount(\"tpl\",LOG_CODE+\"-init\",amc.fn.getTplId?amc.fn.getTplId():\"bizapp\");trackLog(\"b416.c1058\",{actionId:\"exposure\"});notifyPayScene(\"startPay\")}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var a={backMode:\"back\"};var b=amc.fn.getNav(amc.res.navBack,\"{{return}}\",paymentType,null,null,onBack,null,a);getTag(\"body\").insertBefore(b,getTag(\"mainBody\"));getTag(\"mainBody\").style.height=amc.specs.bodyHeight;getTag(\"rmbIconDefaultAmount\").src=amc.path+\"alipay_msp_rmb\";getTag(\"rmbIconManualInput\").src=amc.path+\"alipay_msp_rmb\";var c=getTag(\"avatar\")||{};c.src=rpc.avatar||defaultAvatar;c.defaultvalue=defaultAvatar;c.failurevalue=defaultAvatar;getTag(\"nameLabel\").style.maxWidth=window.innerWidth-100-(showC2CLabel?50:0);gAmountTag=getTag(\"amountInput\");gCommentTag=getTag(\"commentInput\");getTag(\"inputTip\").innerText=paymentType+\"金额\";getTag(\"payToInfo\").innerText=paymentType+\"给\";setPayeeName(nickName);submitting(true);if(isC2C()){initC2CPay()}else{}if(!isDefaultAmountPay){if(amc.isAndroid){gAmountTag.autofocus=\"true\"}else{gAmountTag.focus()}}getTag(\"mainBody\").style.height=amc.specs.bodyHeight}function setPayeeName(b){if(!b){return}var a=getTag(\"nameLabel\");a.innerText=b+realNameInfo}function submitLBSInfo(){document.invoke(\"location\",function(a){if(!a||!a.latitude||!a.longitude||!gTradeNo){return}var b={latitude:a.latitude,longitude:a.longitude,accuracy:a.accuracy,serviceBizType:rpc.serviceBizType||\"\",orderScene:rpc.scene||\"\",tradeNo:gTradeNo};trackLog(\"a87.b416.c7815.d13637\",{bizType:\"TransferPay\",param4:\"latitude=\"+b.latitude+\"^longitude=\"+b.longitude+\"^accuracy=\"+b.accuracy+\"^serviceBizType=\"+b.serviceBizType+\"^orderScene=\"+b.orderScene+\"^tradeNo=\"+b.tradeNo})})}function spmTrackerFeedback(a,g,b,f){if(!a||!b){return}try{var d={type:a||\"monitor\",spmId:b,param4:f!=null?JSON.stringify(f):\"\",actionId:g||\"exposure\",logLevel:\"2\",bizCode:\"TransferPay\"};amc.fn.feedback(\"spmtracker\",d)}catch(c){}}function initC2CPay(){if(showC2CLabel){show(\"c2cLabel\")}show(\"securityInfo\");if(isDefaultAmountPay){show(\"defaultAmountRegion\");hide(\"manualInputRegion\");hide(\"amountInput\");if(rpc.memo){getTag(\"defaultMemo\").innerText='\"'+rpc.memo+'\"'}gAmount=rpc.amount?rpc.amount+\"\":\"\";defaultAmountTag=getTag(\"defaultAmount\");defaultAmountTag.innerText=gAmount;if(gAmount.length>=8){var a=window.innerWidth-60;if(gAmount.length*30>a){defaultAmountTag.className=\"default-amount-small-font\"}}submitting(false)}getAccountDetail(rpc.pid,function(b){if(b&&b.memo){setPayeeName(b.memo);gMemoName=nickName}})}function isDefaultAmountPay(){var a=rpc.amount?rpc.amount+\"\":\"\";return isC2C()&&a.match(validInputReg)}function isC2C(){return rpc.serviceBizType===\"C2C\"}function isEnterprise(){if(!rpc.exParams){return false}var b;if(amc.fn.isObject(rpc.exParams)){b=rpc.exParams}else{try{b=JSON.parse(rpc.exParams)}catch(a){}}b=b||{};return(b.accountType===1||b.accountType===\"1\")}function onSubmit(){amc.fn.hideKeyboard();trackLog(\"b416.c1058.d1670\");submitting(true);showLoading(true);placeOrder(getOrderParam(),function(a){showLoading(false);a=a||{};gTradeNo=a.tradeNo;tradePay({tradeNO:a.tradeNo,bizContext:JSON.stringify({sc:\"tqrcode\",resultPageExitMode:\"2\"})},a.passExtendParams,function(){setTimeout(function(){submitLBSInfo();globalExit()},20)},function(b){notifyPayScene(\"payFail\");b=b||{};var c=b.resultCode;if(c&&(c===\"4000\"||c===\"6001\"||c===\"6002\"||c===\"6006\")){submitting(false)}amc.fn.logError(LOG_CODE+\"-pay-f\"+(b.error?\"-\"+b.error:\"\"),\"支付失败: \"+c||\"\")})},function(a){showLoading(false);submitting(false);a=a||{};var b=a.detailErrorCode;if(b){toast(getMessage(a.detailErrorCode))}amc.fn.logError(LOG_CODE+\"-ord-f\"+(a.error?\"-\"+a.error:\"\"),\"下单失败\"+(b||\"\"))})}function getMessage(a){var c=\"网络开小差，请稍后重试\";var b={SYSTEM_ERROR:c,INVALID_PARAMETER:c,ACCESS_FORBIDDEN:\"服务尚未生效，还不能收款，请稍候再试。\",EXIST_FORBIDDEN_WORD:\"卖家店铺名称有敏感词汇，请联系卖家修改\",PARTNER_ERROR:\"交易存在风险，暂不支持付款\",TOTAL_FEE_EXCEED:\"付款金额超过卖家当日收款上限，请重新填写\",BUYER_SELLER_EQUAL:\"您不能给自己付款\",BUYER_ENABLE_STATUS_FORBID:\"您的账户存在风险，暂不支持付款，请拨打客服电话95188咨询处理。\",SELLER_BEEN_BLOCKED:\"卖家账户异常，暂不支持收款，请拨打客服电话95188-6咨询处理。\",ERROR_SELLER_CERTIFY_LEVEL_LIMIT:\"该码尚未启用，请收款人登录支付宝-我的-余额，补全本人身份信息即可收款。\",ORDER_SESSION_TIMEOUT:\"停留时间太长，请重新扫码支付\"};if(typeof a!==\"string\"){return c}return b[a.toUpperCase()]||c}function getAccountDetail(a,b){if(!a){return}setTimeout(function(){document.invoke(\"queryExistingAccounts\",{uids:[a]},function(c){if(c&&c.error){amc.fn.logError(LOG_CODE+\"-acc\",\"getAccountDetail\"+c.error)}if(c&&c.contactsDicArray&&c.contactsDicArray.length){b&&b(c.contactsDicArray[0])}else{b&&b(null)}})},20)}function notifyPayScene(b){if(!isC2C()){return}var a={fromUid:rpc.uid,toUid:rpc.pid,reqScene:b,reqInfo:{paySessionId:rpc.paySessionId,amount:rpc.amount}};postRPC(\"alipay.livetradeprod.c2c.transfer.notify\",a,function(c){amc.fn.logAction(LOG_CODE+\"-noti-s\",\"支付场景通知成功\")},function(){result=result||{};amc.fn.logError(LOG_CODE+\"-noti-f\"+(result.error?\"-\"+result.error:\"\"),\"支付场景通知失败\")})}function tradePay(c,e,f,g){c=c||{};var d={tradeNO:c.tradeNO,bizContext:c.bizContext,displayPayResult:false,bizType:\"trade\"};var a={};if(amc.fn.isObject(e)){for(var b in e){if(d[b]===undefined){a[b]=e[b]+\"\"}}d.extParams=a}document.invoke(\"pay\",d,function(h){h=h||{};if(h.resultCode==\"9000\"){f&&f(h);return}else{if(h.resultCode==\"8000\"||h.resultCode==\"6004\"){showGotoBillConfirm()}else{if(h.resultCode==\"4000\"){toast(\"支付失败\",{type:\"fail\"})}else{if(h.resultCode==\"6002\"){toast(\"网络不给力\",\"fail\")}}}}g&&g(h)})}function showGotoBillConfirm(){var a={title:\"\",message:\"网络开小差，请到账单列表查看。\",okButton:\"确定\",};document._confirm(a,function(b){if(b.ok){document.submit({action:{name:\"loc:openurl('alipays://platformapi/startApp?appId=20000003')\"}})}})}function getOutTradeNo(b){b=b||\"\";var a=TRADE_NO_PREFIX+b.slice(-3);var c=createGuid().replace(/\\-/g,\"\");return a+c}function getSubject(){if(isC2C()){var a=gComment||rpc.memo||\"收款\";return a}else{var b=nickName||\"收钱码\";if(gComment){b=b+\"-\"+gComment}return b}}function getOrderParam(){var b=gAmount||\"\";var a=b.length;if(a>0&&b.charAt(a-1)===\".\"){b=b.substr(0,a-1)}var c={productCode:rpc.product,partnerId:rpc.pid,buyerId:rpc.uid,subject:getSubject(),outTradeNo:getOutTradeNo(rpc.uid),totalFee:b,merchantOrderNo:rpc.orderNo,sign:rpc.sign,orderScene:rpc.scene,extendParams:amc.fn.isObject(rpc.exParams)?rpc.exParams:{}};if(this.isC2C()){c.extendParams.apdidToken=document.getCustomAttr(\"apdidToken\");c.extendParams.business_info={paySessionId:rpc.paySessionId,assignAmount:(rpc.amount===\"\"||rpc.amount===undefined)?\"false\":\"true\"}}return c}function placeOrder(a,c,d){var b=\"alipay.acquire.order.create\";if(rpc.exParams&&rpc.exParams.apiMethod){b=rpc.exParams.apiMethod}postRPC(b,a,function(e){c&&c(e)},function(e){d&&d(e)})}function postRPC(b,c,d,e){if(!b){return}var a={operationType:b,requestData:c};setTimeout(function(){document.invoke(\"rpc\",a||{},function(f){f=f||{};if(isRpcSuccess(f)){d&&d(f)}else{commonErrorForPostRPC(f);e&&e(f)}})},10)}function commonErrorForPostRPC(a){a=a||{};if(a.tips){toast(a.tips)}else{if(a.error==\"10\"||a.error==\"11\"){toast(\"网络不给力\",\"fail\")}else{if(a.error){toast(\"网络开小差，请稍后重试\")}}}}function trackLog(a,b){if(typeof b===\"string\"){b={type:b}}setTimeout(function(){document.invoke(\"log\",{spmId:\"a87.\"+a,params:amc.fn.isObject(b)?b:{}})},20)}function isRpcSuccess(a){return a&&(a.success||a.resultCode===\"SUCCESS\"||a.resultCode===\"success\")}function createGuid(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d===\"x\"?b:(b&3|8);return a.toString(16)})}function showLoading(a){setTimeout(function(){document.invoke(a?\"showLoading\":\"hideLoading\")},20)}function toast(c,a,b){if(!c){return}if(amc.isAndroid){if(b&&gToastDisabled){return}else{setTimeout(function(){gToastDisabled=false},2000);gToastDisabled=true}}document.toast({text:c,type:a||\"none\"},function(){})}function submitting(b){var a=getTag(\"submitBtn\");a.disabled=b;getTag(\"btnText\").style.color=b?\"#d2d2d2\":\"#fff\"}function onCommentInput(){var a=gCommentTag.value||\"\";a=a.trim();gComment=a}function onAmountInput(){var c=gAmountTag.value||\"\";if(c&&!c.match(validInputReg)){var b=/^\\d{8}/;if(b.test(c)){toast(\"付款金额过大\")}gAmountTag.value=gAmount;return}var a=parseFloat(c);if(a>limitAmount){toast(\"单笔金额最多\"+limitAmount.toFixed(2)+\"元\",null,true);gAmountTag.value=gAmount;return}gAmount=c;if(gAmount.length>=TEXT_SIZE_THRESHOLD){gAmountTag.className=\"input amount-input small-amount-font  amc-flex-1 \"}else{gAmountTag.className=\"input amount-input amount-font amc-flex-1\"}updateButtonState()}function updateButtonState(){var a=parseFloat(gAmount);var b=(isNaN(a)||a<=0);submitting(b)}function onAmountInputFocus(){trackLog(\"b416.c1058.d1669\")}function onBack(){notifyPayScene(\"quitPay\");globalExit()}function globalExit(){if(window.exited){return}window.exited=true;setTimeout(function(){amc.fn.exit()},100)}function onCommentInputFocus(){if(amc.isAndroid){document.setProp(\"focusableInTouchMode\",{value:true})}}function onReturn(){if(event.which==\"keycode_confirm\"||event.which==10){if(!getTag(\"submitBtn\").disabled){if(amc.isIOS){amc.fn.hideKeyboard()}}}else{if(event.which==4){onBack()}}}function onReturnComment(){if(event.which==\"keycode_confirm\"||event.which==10){if(amc.isIOS){amc.fn.hideKeyboard()}else{getTag(\"avatar\").focus()}}else{if(event.which==4){onBack()}}}function onKeyDown(){if(event.which==4){onBack()}};","tag":"text"}]},{"tag":"style","children":[{"text":".top-box {\n        padding: 15px 15px 15px 15px;\n    }\n\n    .avatar {\n        height: 64px;\n        width: 64px;\n        border-radius: 2px;\n    }\n\n    .info {\n        font-size: 16px;\n        color: #000;\n    }\n\n    .info-box {\n        margin-top: 10px;\n        min-height: 25px;\n        align-items: center;\n    }\n\n    .tip {\n        font-size: 14px;\n        color: #000;\n    }\n\n    .rmb-icon-box {\n        justify-content: flex-end;\n        padding-bottom: 11px;\n    }\n\n    .rmb-box {\n        height: 65px;\n        align-items: flex-end;\n        padding-bottom: 8px;\n    }\n\n    .rmb-icon {\n        width: 21px;\n        height: 42px;\n        max-width: 21px;\n    }\n\n    .amount-input {\n        max-height: 65px;\n        margin-left: 5px;\n        font-weight: bold;\n    }\n\n    .small-amount-font {\n        font-size: 40px;\n    }\n\n    .amount-font {\n        font-size: 50px;\n    }\n\n    .input {\n        flex: 1.0;\n        border: 0;\n        color: #000;\n        padding: 0px;\n        white-space: nowrap;\n    }\n\n    .comment-input {\n        font-size: 14px;\n        height: 36px;\n    }\n\n    .amount-box {\n        padding-top: 10px;\n        font-size: 14px;\n    }\n\n    .comment-box {\n        margin-top: 3px;\n    }\n\n    .btn-box {\n        margin-top: 30px;\n    }\n\n    .pd-lr {\n        padding-left: 15px;\n        padding-right: 15px;\n    }\n\n    .amout-input-box {\n        padding-bottom: 10px;\n        align-items: stretch;\n    }\n\n    .default-tip {\n        font-size: 14px;\n        color: #999;\n    }\n\n    .default-amount {\n        align-self: center;\n        font-size: 55px;\n    }\n\n    .default-amount-small-font {\n        font-size: 38px;\n        height: 55px;\n    }\n\n    .default-amount-box {\n        margin-top: -79px;\n        height: 79px;\n        max-height: 79px;\n    }\n\n    .lines-box {\n        margin-top: 9px;\n        background-color: rgba(0, 0, 0, 0)\n    }\n\n    .gray-line {\n        height: 2PX;\n        background-color: #e4e4e4;\n        margin-top: 9px;\n    }\n\n    .gray-line-first {\n        margin-top: 0;\n    }\n\n    .manual-input-region {\n        margin-top: 30px;\n    }\n\n    .default-region {\n        margin-top: 15px;\n    }\n\n    .c2c-label-box {\n        border: 1px solid #ff7305;\n        border-radius: 2px;\n        height: 19.5px;\n        padding: 0 3px;\n        margin: 0 3px;\n        align-items: center;\n    }\n\n    .c2c-label-text {\n        font-size: 12px;\n        color: #ff7305;\n    }\n\n    .sec-info {\n        font-size: 14px;\n        color: #ccc;\n    }\n\n    .pd {\n        padding: 15px;\n    }\n\n    .bottom-line-adjust {\n        margin-top: -5px;\n    }\n\n    .for-auto-scroll {\n        height: 80px;\n    }","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{},{"tag":"div","children":[{"id":"avatar","tag":"img","css":"avatar"},{"tag":"div","children":[{"id":"payToInfo","tag":"label","css":"info"},{"id":"c2cLabel","tag":"div","children":[{"tag":"label","children":[{"text":"个人账户","tag":"text"}],"css":"c2c-label-text"}],"css":"c2c-label-box amc-hidden"},{"id":"nameLabel","tag":"label","emoji":"true","css":"info amc-ellipsis"}],"css":"amc-flex-center info-box"}],"css":"top-box amc-v-box amc-align-center"},{},{"id":"defaultAmountRegion","tag":"div","children":[{"tag":"div","children":[{"id":"defaultMemo","tag":"label","css":"default-tip amc-flex-1 amc-text-center amc-ellipsis-2-line"}],"css":"amc-justify-center"},{"tag":"div","children":[{"tag":"div","css":"gray-line gray-line-first"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"},{"tag":"div","css":"gray-line"}],"css":"lines-box amc-v-box"},{"tag":"div","children":[{"tag":"div","children":[{"id":"rmbIconDefaultAmount","tag":"img","css":"rmb-icon"}],"css":"amc-v-box rmb-icon-box"},{"tag":"div","children":[{"id":"defaultAmount","tag":"label","css":"default-amount"}],"css":"amc-align-cetner"}],"css":"amc-justify-center default-amount-box"}],"css":"amc-v-box default-region amc-hidden"},{},{"id":"manualInputRegion","tag":"div","children":[{"tag":"div","children":[{"id":"inputTip","tag":"label","css":"tip"}]},{"tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"id":"rmbIconManualInput","tag":"img","css":"rmb-icon"}],"css":"rmb-box"},{"tag":"div","children":[{"id":"amountInput","maxlength":"13","placeholder":"","tag":"input","value":"","onkeydown":"onReturn();","onfocus":"onAmountInputFocus();","type":"money","css":"input amount-input amount-font amc-flex-1","oninput":"onAmountInput();"}],"css":"amc-flex-1"}],"css":"amout-input-box"},{"tag":"div","css":"amc-1px-line bottom-line-adjust"}],"css":"amount-box amc-v-box"}],"css":"amc-v-box manual-input-region"},{"tag":"div","children":[{"id":"commentInput","maxlength":"20","placeholder":"添加备注(20个字)","tag":"input","onfocus":"onCommentInputFocus();","onkeydown":"onReturnComment();","css":"input comment-input amc-flex-1","oninput":"onCommentInput();"}],"css":"comment-box"},{},{"tag":"div","children":[{"tag":"div","children":[{"id":"submitBtn","tag":"div","children":[{"id":"btnText","tag":"label","children":[{"text":"确认付款","tag":"text"}],"css":"amc-btn-disabled-color amc-font-super-l amc-ellipsis amc-flex-1 amc-text-center"}],"onclick":"onSubmit();","disabled":"true","css":"amc-btn-primary amc-justify-center amc-align-center"}],"css":"amc-flex-1"}],"css":"btn-box"},{"tag":"div","css":"amc-flex-1"},{},{"tag":"div","children":[{"id":"securityInfo","tag":"label","children":[{"text":"钱将实时付到对方账户，无法退款","tag":"text"}],"css":"amc-hidden sec-info amc-text-center amc-flex-1 amc-ellipsis"},{"tag":"div","css":"amc-iphone-x-pd-b"}],"css":"pd amc-bg-white amc-v-box"}],"css":"pd-lr amc-v-box amc-scroll amc-bg-white"}],"onkeydown":"onKeyDown();","css":"amc-body amc-bg-white"}]},"format":"JSON","tplVersion":"5.3.0"}